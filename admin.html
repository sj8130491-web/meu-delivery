<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>@media print { .no-print { display: none; } }</style>
</head>
<body class="bg-gray-100">

    <nav class="bg-white p-4 shadow mb-6 no-print">
        <h1 class="text-center font-black text-orange-600 uppercase">Administração de Vendas</h1>
    </nav>

    <main class="max-w-xl mx-auto p-4 no-print">
        <div id="lista-vendas" class="space-y-4 text-sm">Carregando histórico...</div>
    </main>

    <div id="modal-comanda" class="fixed inset-0 bg-white z-50 hidden p-6">
        <div class="max-w-sm mx-auto border-2 border-black p-4 text-black text-xs font-mono">
            <div class="text-center mb-2 border-b-2 border-dashed border-black pb-2">
                <h2 class="font-bold text-lg uppercase">Espetinho do Chefe</h2>
                <p id="com-data"></p>
            </div>
            <div class="mb-2 space-y-1">
                <p><b>CLIENTE:</b> <span id="com-cliente"></span></p>
                <p><b>ZAP:</b> <span id="com-tel"></span></p>
                <p><b>TIPO:</b> <span id="com-tipo"></span></p>
                <p><b>END:</b> <span id="com-end"></span></p>
                <p><b>PAGAMENTO:</b> <span id="com-pag"></span></p>
            </div>
            <div class="border-b-2 border-dashed border-black mb-2 pb-1">
                <p><b>ITENS:</b></p>
                <div id="com-itens"></div>
            </div>
            <div class="text-right text-lg font-bold">TOTAL: <span id="com-total"></span></div>
            <div class="mt-6 flex gap-2 no-print">
                <button onclick="window.print()" class="bg-black text-white p-3 flex-1 font-bold">IMPRIMIR</button>
                <button onclick="document.getElementById('modal-comanda').classList.add('hidden')" class="bg-gray-200 p-3 flex-1 font-bold">FECHAR</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const supabaseUrl = 'https://njxejwrdjemmrmdtenit.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5qeGVqd3JkamVtbXJtZHRlbml0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxOTg5MTYsImV4cCI6MjA4Nzc3NDkxNn0.HlZh45ptmLnt09nclbrwFNKshiyhBaLkBfhfLz-5xB4';
        const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

        async function carregarVendas() {
            const { data } = await _supabase.from('pedidos').select('*').order('id', { ascending: false });
            document.getElementById('lista-vendas').innerHTML = data.map(p => `
                <div class="bg-white p-4 rounded-xl shadow flex justify-between items-center border-l-4 border-orange-500">
                    <div><b>${p.cliente}</b><br><span class="text-xs text-gray-400">R$ ${p.total.toFixed(2)}</span></div>
                    <button onclick='abrirComanda(${JSON.stringify(p)})' class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold">Comanda</button>
                </div>
            `).join('');
        }

        function abrirComanda(p) {
            document.getElementById('com-cliente').innerText = p.cliente;
            document.getElementById('com-tel').innerText = p.whatsapp || '---';
            document.getElementById('com-tipo').innerText = p.tipo_entrega || 'Entrega';
            document.getElementById('com-end').innerText = p.endereco || '---';
            document.getElementById('com-pag').innerText = p.forma_pagamento || 'A combinar';
            document.getElementById('com-itens').innerText = p.itens;
            document.getElementById('com-total').innerText = `R$ ${p.total.toFixed(2)}`;
            document.getElementById('com-data').innerText = new Date().toLocaleString();
            document.getElementById('modal-comanda').classList.remove('hidden');
        }
        carregarVendas();
    </script>
</body>
</html>