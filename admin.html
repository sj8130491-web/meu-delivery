<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel Admin | Gestão Delivery</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-4 sm:p-8">
    <div class="max-w-5xl mx-auto">
        <h1 class="text-3xl font-black mb-8 text-gray-800">GESTÃO DE DELIVERY</h1>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8">
            <div class="bg-white p-6 rounded-2xl shadow-sm border-l-4 border-green-500">
                <p class="text-gray-400 text-xs font-bold uppercase">Vendas Hoje</p>
                <p id="fin-total" class="text-2xl font-black text-gray-800">R$ 0,00</p>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border-l-4 border-blue-500">
                <p class="text-gray-400 text-xs font-bold uppercase">Pedidos</p>
                <p id="fin-qtd" class="text-2xl font-black text-gray-800">0</p>
            </div>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-sm mb-8">
            <h2 class="font-black text-sm uppercase mb-4 text-red-600 italic">Cadastrar Produto</h2>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                <input id="cad-nome" type="text" placeholder="Nome" class="border p-3 rounded-xl outline-none">
                <input id="cad-preco" type="number" placeholder="Preço" class="border p-3 rounded-xl outline-none">
                <select id="cad-cat" class="border p-3 rounded-xl outline-none">
                    <option value="marmitas">Marmitas</option>
                    <option value="espetinhos">Espetinhos</option>
                    <option value="bebidas">Bebidas</option>
                </select>
                <input id="cad-img" type="text" placeholder="Link Imagem" class="border p-3 rounded-xl outline-none sm:col-span-3">
                <textarea id="cad-desc" placeholder="Descrição" class="border p-3 rounded-xl outline-none sm:col-span-3"></textarea>
                <textarea id="cad-ing" placeholder="Ingredientes" class="border p-3 rounded-xl outline-none sm:col-span-3"></textarea>
                <button onclick="salvar()" class="bg-red-600 text-white font-black p-4 rounded-xl sm:col-span-3">CADASTRAR</button>
            </div>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-sm overflow-hidden">
            <h2 class="font-black text-sm uppercase mb-4">Pedidos de Hoje</h2>
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm">
                    <thead><tr class="text-gray-400 border-b"><th>Hora</th><th>Cliente</th><th>Total</th><th class="text-right">Ação</th></tr></thead>
                    <tbody id="lista-pedidos"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="print-area" class="hidden">
        <div id="print-content" style="font-family: monospace; width: 80mm; padding: 10px;"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const _supabase = supabase.createClient('https://njxejwrdjemmrmdtenit.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5qeGVqd3JkamVtbXJtZHRlbml0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxOTg5MTYsImV4cCI6MjA4Nzc3NDkxNn0.HlZh45ptmLnt09nclbrwFNKshiyhBaLkBfhfLz-5xB4');

        async function salvar() {
            const obj = {
                nome: document.getElementById('cad-nome').value,
                preco: parseFloat(document.getElementById('cad-preco').value),
                categoria: document.getElementById('cad-cat').value,
                imagem: document.getElementById('cad-img').value,
                descricao: document.getElementById('cad-desc').value,
                ingredientes: document.getElementById('cad-ing').value
            };
            await _supabase.from('produto').insert([obj]);
            location.reload();
        }

        async function carregarDados() {
            const hoje = new Date().toISOString().split('T')[0];
            const { data: pedidos } = await _supabase.from('pedidos').select('*').gte('created_at', hoje);
            
            if(pedidos) {
                document.getElementById('fin-total').innerText = `R$ ${pedidos.reduce((a,b) => a+b.total, 0).toFixed(2)}`;
                document.getElementById('fin-qtd').innerText = pedidos.length;
                document.getElementById('lista-pedidos').innerHTML = pedidos.map(p => `
                    <tr class="border-b">
                        <td class="py-4">${new Date(p.created_at).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</td>
                        <td class="font-bold">${p.cliente}</td>
                        <td class="text-green-600 font-bold text-xs">R$ ${p.total.toFixed(2)}</td>
                        <td class="text-right"><button onclick="imprimir('${p.id}')" class="bg-black text-white px-3 py-1 rounded text-[10px]">IMPRIMIR</button></td>
                    </tr>
                `).join('');
            }
        }

        async function imprimir(id) {
            const { data: p } = await _supabase.from('pedidos').select('*').eq('id', id).single();
            const content = `
                <div style="text-align:center"><b>ESPETINHO DO CHEFE</b><br>--- COMANDA ---</div><br>
                <b>CLIENTE:</b> ${p.cliente}<br>
                <b>PAGAMENTO:</b> ${p.pagamento}<br>
                <b>DATA:</b> ${new Date(p.created_at).toLocaleString()}<br>
                -------------------------<br>
                <b>ITENS:</b><br>${p.itens.replace(/,/g, '<br>')}<br>
                -------------------------<br>
                <div style="font-size:16px"><b>TOTAL: R$ ${p.total.toFixed(2)}</b></div>
            `;
            const win = window.open('', '', 'width=300,height=600');
            win.document.write(content);
            win.print(); win.close();
        }

        carregarDados();
    </script>
</body>
</html>